[[_TOC_]]

# 悬壶数据同步后台接口

## 数据源模块

### GET /api/db/list 分页获取/搜索数据源列表

```
request
{
  "searchText": null,  //名称搜索
  "page": 1,
  "size": 10
}
respose
{
	code: (int), // 状态码 200-成功，201-失败
	successMsg: (String), // 消息内容 
	data: [{
		"id": 1,
		"name": "测试",
		"type": "MYSQL",
		"typeName": "MySQL",
		"version": "mysql-8",
		"driver": "com.mysql.jdbc.Driver",
		"address": "127.0.0.1",
		"port": "3306",
		"databaseName": "cxx",
		"characterEncoding": "utf8",
		"url": "jdbc:mysql://127.0.0.1:3306/",
		"username": "root",
		"password": "123456",
		"createTime": "2024-05-27 08:46:08",
		"updateTime": "2024-05-27 08:46:08"
	}],
	errorMsg: (String), //错误信息
	detail：（ String), //堆栈信息
}


```

### POST /api/db/add 添加数据源信息

```
request
{
	"id": "", 									// 空
	"name": "测试", 							  // 数据源名称
	"type": "MYSQL", 						   // 数据库类型：MySql ...
	"version": "mysql-8", 						// 对应的数据库版本
	"driver": "com.mysql.jdbc.Driver", 			// 数据库驱动
	"address": "127.0.0.1", 					// 链接地址
	"port": "3306",								 // 端口
	"databaseName": "cxx", 						// 数据库名称
	"characterEncoding": "utf8", 				// 数据库编码
	"url": "jdbc:mysql://127.0.0.1:3306/....", // jdbc链接地址
	"username": "root", 						// 数据库账号
	"password": "123456" 						// 数据库密码
}

respose
{
	code: (int),			// 状态码 200-成功，201-失败
	successMsg: (String),	// 消息内容 
	data:(Object),   
	errorMsg:(String),      //错误信息
	detail：（String),       //堆栈信息
}
```

### PUT /api/db/update 数据源信息更新

```
request
{
	"id": "1", 									// 必填
	"name": "测试", 							  // 数据源名称
	"type": "MYSQL", 						   // 数据库类型：MySql ...
	"version": "mysql-8", 						// 对应的数据库版本
	"driver": "com.mysql.jdbc.Driver", 			// 数据库驱动
	"address": "127.0.0.1", 					// 链接地址
	"port": "3306",								 // 端口
	"databaseName": "cxx", 						// 数据库名称
	"characterEncoding": "utf8", 				// 数据库编码
	"url": "jdbc:mysql://127.0.0.1:3306/....", // jdbc链接地址
	"username": "root", 						// 数据库账号
	"password": "123456" 						// 数据库密码
}

respose
{
	code: (int),			// 状态码 200-成功，201-失败
	successMsg: (String),	// 消息内容 
	data:(Object),   
	errorMsg:(String),      //错误信息
	detail：（String),       //堆栈信息
}
```

### DEL /api/db/update 数据源信息更新

```
request
{
	"id": "1", 									// 必填
}

respose
{
	code: (int),			// 状态码 200-成功，201-失败
	successMsg: (String),	// 消息内容 
	data:(Object),   
	errorMsg:(String),      //错误信息
	detail：（String),       //堆栈信息
}
```

### PUT /api/db/test 数据源预测试链接

```
request
{								
	"name": "测试", 							  // 数据源名称
	"type": "MYSQL", 						   // 数据库类型：MySql ...
	"version": "mysql-8", 						// 对应的数据库版本
	"driver": "com.mysql.jdbc.Driver", 			// 数据库驱动
	"address": "127.0.0.1", 					// 链接地址
	"port": "3306",								 // 端口
	"databaseName": "cxx", 						// 数据库名称
	"characterEncoding": "utf8", 				// 数据库编码
	"url": "jdbc:mysql://127.0.0.1:3306/....", // jdbc链接地址
	"username": "root", 						// 数据库账号
	"password": "123456" 						// 数据库密码
}

respose
{
	code: (int), 			// 状态码 200-成功，201-失败
	successMsg: (String),   // 消息内容 
	data: {
		time: Number,	 //耗时时间

	},
	errorMsg: (String), //错误信息
	detail：（ String), //堆栈信息
}
```

## 元数据查询接口

### POST /api/meatdata/sql/{id} SQL脚本数据结果集接口

```
request
{
  "script": "select * from orders;",
  "page": 1,
  "size": 200
}
respose
{
	code: (int), // 状态码 200-成功，201-失败
	successMsg: (String), // 消息内容 
	data: {
		"results": [{
			"columns": [{                  //列数据
				"columnName": "string",
				"columnType": "string"
			}],
			"rows": [{                     //行数据
				"additionalProp1": {},
				"additionalProp2": {},
				"additionalProp3": {}
			}]
		}],
		"summaries": [{
			"sql": "string",     //SQL脚本内容
			"summary": "string"  //总耗时
		}]
	},
	errorMsg: (String), //错误信息
	detail：（ String), //堆栈信息
}
```

### GET /api/metadata/table/data/{id} 物理表视图表数据内容

```
request
{
	schema: '', //对应数据库
	table: ''  // 对应表名称
}

respose
{
	code: (int), 			// 状态码 200-成功，201-失败
	successMsg: (String),   // 消息内容 
	data:{
    "columns": [
      "string"
    ],
    "rows": [
      {
        "additionalProp1": {},
        "additionalProp2": {},
        "additionalProp3": {}
      }
    ],
    "schemaName": "string",
    "tableName": "string"
  },
	errorMsg: (String), //错误信息
	detail：（ String), //堆栈信息
}
```

### GET /api/metadata/table/meta/{id} 物理表/视图表信息

```

request
{
	schema: '', //对应数据库
	table: ''  // 对应表名称
}

respose
{
	code: (int), 			// 状态码 200-成功，201-失败
	successMsg: (String),   // 消息内容 
	data:{
    "columns": [
      {
        "fieldName": "string", //字段名称
        "fieldType": "string", //字段类型
        "remarks": "string",//备注
      }
    ],
   
    "remarks": "string", //表备注
    "tableName": "string", //表名称
    "type": "string" //类型
  },
	errorMsg: (String), //错误信息
	detail：（ String), //堆栈信息
}
```







