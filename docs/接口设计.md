[[_TOC_]]

# 悬壶数据同步后台接口

## 问题

1. 这个文档看起来不像是手写的，排版乱得一塌糊涂
2. 大量拼写错误，response写错几十遍
3. 字段类型非常随意，不按实际情况思考，像敷衍了事
4. 接口是DELETE不是DEL
5. 接口路径需要统一，id要么放路径，要么放参数
6. 接口命名用复数，如menus代替menu
7. 接口方法POST就是add的意思，PATCH是update，PUT是整体更新
8. 补全error里面的异常情况
9. 类型是类型，值是值，`"id": 1`，应该是`id: (int)`，不要引号

文档是给其他合作者看的，大家在GitHub上review文档，提交一份乱七八糟的东西，是没人会理你的。

## 系统公共模块

### POST /api/login 用户登录

```
@request
{
  "username": String, // 用户名
  "password": String, // 密码
  "code": String, // 验证码
}
@response
{
    userInfo: Object, // 用户主要信息
    token: String // 用户Token
}
@error
{
    1001: "用户找不到",
    // TODO
}
```

## 菜单模块

### GET /api/menus 分页获取菜单

```
@request
{
  "searchText": null, // 名称搜索
  "page": 1,
  "size": 10
}
@response
{
      list:[{
      "id": 1,		// 菜单项ID
      "name": String,// 菜单名称
      "pid": String,  // 父ID
      "path": String,  //路由路径
      "component": String, // 组件路径
      "icon": String, // icon名称
      "title": String, // 页面标题,
  	  }],
      pageInfo:{
           total:100
       }
}
@error
{
    // TODO
}
```

### POST /api/menus 新增菜单

```
@request
{
   "name": String,// 菜单名称
   "pid": String,  // 父ID
   "path": String,  //路由路径
   "component": String, // 组件路径
   "icon": String, // icon名称
   "title": String, // 页面标题,
 }
@response
{
}
```



### PUT /api/menus/{id} 更新菜单

```
@request
{
   "id": 1,		// 菜单项ID
   "name": String,// 菜单名称
   "pid": String,  // 父ID
   "path": String,  //路由路径
   "component": String, // 组件路径
   "icon": String, // icon名称
   "title": String, // 页面标题,
 }
@response
{
}
@error
{
    // TODO
}
```

### DELETE /api/menu/{id} 删除菜单

```
@request
{
}
@response
{
}
@error
{
    // TODO
}
```

## 项目模块

### GET /api/project/list 分页获取项目列表

```
@request
{
  "searchText": null, // 名称搜索
  "page": 1,
  "size": 10
}
@response
{

      list:[{
      "id": 1,		// 项目ID
      "projectName": String,// 项目名称
      "projectDesc": String,  // 项目描述
      "createTime": String,  //项目创建时间
      "updateTime": String, // 项目更新时间
  	  }],
      pageInfo:{
           total:100
       }
}
@error
{
    // TODO
}
```

### POST /api/project/add 新增项目

```
@request
{
   "projectName": String,// 项目名称
   "projectDesc": String,  // 项目描述
   "createTime": String,  //项目创建时间
   "updateTime": String, // 项目更新时间
 }
@response
{
}
@error
{
    // TODO
}
```



### PUT /api/project/update 更新项目信息

```
@request
{
   "id": 1,		// 项目ID
   "projectName": String,// 项目名称
   "projectDesc": String,  // 项目描述
   "createTime": String,  //项目创建时间
   "updateTime": String, // 项目更新时间
 }
@response
{
}
@error
{
    // TODO
}
```

### DELETE /api/project/{id} 删除项目

```
@request
{ 
    // 无  
}
@response
{ 
    // 无
}
@error
{
    // TODO
}
```

## 数据源模块

### GET /api/db/list 分页获取/搜索数据源列表

```
@request
{
  "searchText": null, // 名称搜索
  "page": 1,
  "size": 10
}
@response
{
        list:[{
		"id": 1,
		"name": "测试",
		"type": "MYSQL",
		"typeName": "MySQL",
		"version": "mysql-8",
		"driver": "com.mysql.jdbc.Driver",
		"address": "127.0.0.1",
		"port": "3306",
		"databaseName": "cxx",
		"characterEncoding": "utf8",
		"url": "jdbc:mysql://127.0.0.1:3306/",
		"username": "root",
		"password": "123456",
		"createTime": "2024-05-27 08:46:08",
		"updateTime": "2024-05-27 08:46:08"
	}],
       pageInfo:{
           total:100
       }
}
@error
{
    // TODO
}
```

### POST /api/db/add 添加数据源信息

```
@request
{
	"id": "", 									// 空
	"name": "测试", 							  // 数据源名称
	"type": "MYSQL", 						   // 数据库类型：MySql ...
	"version": "mysql-8", 						// 对应的数据库版本
	"driver": "com.mysql.jdbc.Driver", 			// 数据库驱动
	"address": "127.0.0.1", 					// 链接地址
	"port": "3306",								 // 端口
	"databaseName": "cxx", 						// 数据库名称
	"characterEncoding": "utf8", 				// 数据库编码
	"url": "jdbc:mysql://127.0.0.1:3306/....", // jdbc链接地址
	"username": "root", 						// 数据库账号
	"password": "123456" 						// 数据库密码
}
@response
{
}
@error
{
    // TODO
}
```

### PUT /api/db/update 数据源信息更新

```
@request
{
	"id": "1", 									// 必填
	"name": "测试", 							  // 数据源名称
	"type": "MYSQL", 						   // 数据库类型：MySql ...
	"version": "mysql-8", 						// 对应的数据库版本
	"driver": "com.mysql.jdbc.Driver", 			// 数据库驱动
	"address": "127.0.0.1", 					// 链接地址
	"port": "3306",								 // 端口
	"databaseName": "cxx", 						// 数据库名称
	"characterEncoding": "utf8", 				// 数据库编码
	"url": "jdbc:mysql://127.0.0.1:3306/....", // jdbc链接地址
	"username": "root", 						// 数据库账号
	"password": "123456" 						// 数据库密码
}

@response
{
}
@error
{
    // TODO
}
```

### DELETE /api/db/update 数据源信息更新

```
@request
{
	"id": "1", 									// 必填
}
@response
{
}
@error
{
    // TODO
}
```

### PUT /api/db/test 数据源预测试链接

```
@request
{								
	"name": "测试", 							  // 数据源名称
	"type": "MYSQL", 						   // 数据库类型：MySql ...
	"version": "mysql-8", 						// 对应的数据库版本
	"driver": "com.mysql.jdbc.Driver", 			// 数据库驱动
	"address": "127.0.0.1", 					// 链接地址
	"port": "3306",								 // 端口
	"databaseName": "cxx", 						// 数据库名称
	"characterEncoding": "utf8", 				// 数据库编码
	"url": "jdbc:mysql://127.0.0.1:3306/....", // jdbc链接地址
	"username": "root", 						// 数据库账号
	"password": "123456" 						// 数据库密码
}
@response
{
      time: Number, // 耗时时间
}
@error
{
    // TODO
}
```

## 元数据查询接口

### POST /api/meatdata/sql/{id} SQL脚本数据结果集接口

```
@request
{
  "script": "select * from orders;",
  "page": 1,
  "size": 200
}
@response
{
		"results": [{
          "columns": [
            { // 列数据
				"columnName": "string",
				"columnType": "string"
			}],
          "rows": [
            { // 行数据
				"additionalProp1": {},
				"additionalProp2": {},
				"additionalProp3": {}
			}]
		}],
		"summaries": [{
          "sql": "string", // SQL脚本内容
          "summary": "string" // 总耗时
		}]
}
@error
{
    // TODO
}
```

### GET /api/metadata/table/data/{id} 物理表视图表数据内容

```
@request
{
	schema: '', //对应数据库
	table: ''  // 对应表名称
}
@response
{
    "columns": [
      "string"
    ],
    "rows": [
      {
        "additionalProp1": {},
        "additionalProp2": {},
        "additionalProp3": {}
      }
    ],
    "schemaName": "string",
    "tableName": "string"
}
@error
{
    // TODO
}
```

### GET /api/metadata/table/meta/{id} 表信息(字段信息)

```

@request
{
	schema: '', //对应数据库
	table: ''  // 对应表名称
}
@response
{
	code: (int), 			// 状态码 200-成功，201-失败
	successMsg: (String),   // 消息内容 
	data:{
    "columns": [
      {
        "fieldName": "string", // 字段名称
        "fieldType": "string", // 字段类型
        "remarks": "string", // 备注
      }
    ],
      "remarks": "string", // 表备注
      "tableName": "string", // 表名称
    "type": "string" //类型
}
@error
{
    // TODO
}
```

## 定时任务模块

### GET /api/job/list 分页获取/分页获取定时任务列表

```
@request
{
  "searchText": null, //名称搜索
  "status": null, //任务状态
  "page": 1,
  "size": 10
}
@response
{
      "id": 1
      "name": "测试", //任务名称
      "description": "测试", //任务描述
      "cronExpression": "0 0/5 * * * ? *",
      "config": {
        "sourceConnectionId": 1,
        "sourceSchema": "ai",
        "tableType": "TABLE", //表类型 table view
        "includeOrExclude": "INCLUDE", //类型-包含或者排查 
        "sourceTables": [
          "admin"
        ],
        "targetConnectionId": 1,
        "targetSchema": "ai",
        "tableNameMapper": [
          {
            "fromvalue": "1",
            "toValue": "1"
          }
        ],
        "columnNameMapper": [
          {
            "fromvalue": "1",
            "toValue": "1"
          }
        ],
        "tableNameCase": "NONE",
        "columnNameCase": "NONE",
        "targetAutoIncrement": false,
        "batchSize": 5000,
        "beforeSqlScripts": "1",
        "afterSqlScripts": "1"
      }
}

@error
{
    // TODO
}
```

### POST /api/job/add 添加定时任务

```
@request
{
  "name": "测试", //任务名称
  "description": "测试", //任务描述
  "cronExpression": "0 0/5 * * * ? *",
  "config": {
    "sourceConnectionId": 1,
    "sourceSchema": "ai",
    "tableType": "TABLE", //表类型 table view
    "includeOrExclude": "INCLUDE", //类型-包含或者排查 
    "sourceTables": [
      "admin"
    ],
    "targetConnectionId": 1,
    "targetSchema": "ai",
    "tableNameMapper": [
      {
        "fromvalue": "1",
        "toValue": "1"
      }
    ],
    "columnNameMapper": [
      {
        "fromvalue": "1",
        "toValue": "1"
      }
    ],
    "tableNameCase": "NONE",
    "columnNameCase": "NONE",
    "targetAutoIncrement": false,
    "batchSize": 5000,
    "beforeSqlScripts": "1",
    "afterSqlScripts": "1"
  }
}

@response
{

    time: Number //耗时时间
}
@error
{
    // TODO
}
```

### PUT /api/job/update 修改定时任务

```
@request
{
  "id": "1"
  "name": "测试", //任务名称
  "description": "测试", //任务描述
  "cronExpression": "0 0/5 * * * ? *",
  "config": {
    "sourceConnectionId": 1,
    "sourceSchema": "ai",
    "tableType": "TABLE", //表类型 table view
    "includeOrExclude": "INCLUDE", //类型-包含或者排查 
    "sourceTables": [
      "admin"
    ],
    "targetConnectionId": 1,
    "targetSchema": "ai",
    "tableNameMapper": [
      {
        "fromvalue": "1",
        "toValue": "1"
      }
    ],
    "columnNameMapper": [
      {
        "fromvalue": "1",
        "toValue": "1"
      }
    ],
    "tableNameCase": "NONE",
    "columnNameCase": "NONE",
    "targetAutoIncrement": false,
    "batchSize": 5000,
    "beforeSqlScripts": "1",
    "afterSqlScripts": "1"
  }
}
@response
{
    time: Number //耗时时间
}
@error
{
    // TODO
}
```

### DELETE /api/job/del 删除定时任务

```
@request
{
  "id": "1"
  "name": "测试"
}
@response
{

    time: Number //耗时时间
}
@error
{
    // TODO
}
```

### POST /api/job/run 立即执行定时任务

```
@request
{
  "id": "1"
}
@response
{
    time: Number //耗时时间
}
@error
{
    // TODO
}
```

## 系统日志模块

### GET /api/log/list 分页查询定时任务

```
@request
{
  "searchText": null, //任务名称
  "page": 1,
  "size": 10
}
@response
{
      "id": 1,
      "name": "测试", //任务名称
      "type": "MYSQL", //数据库类型
      "version": "mysql-8",
      "driver": "com.mysql.jdbc.Driver", //数据库渠道
      "address": "127.0.0.1", //数据库链接地址
      "port": "3306", //数据库端口
      "databaseName": "test", //数据库名称
      "url": "jdbc:mysql://127.0.0.1:3306/", //jdbc链接地址
      "username": "root",
      "password": "123456",
      "createTime": "2024-05-27 08:46:08",
      "updateTime": "2024-05-27 0 8:46:08"
}
@error
{
    // TODO
}
```
